/*! For license information please see content.js.LICENSE.txt */
(()=>{var t={176:(t,e,r)=>{var n;!function(){"use strict";var o="input is invalid type",i="object"==typeof window,a=i?window:{};a.JS_SHA3_NO_WINDOW&&(i=!1);var s=!i&&"object"==typeof self;!a.JS_SHA3_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node?a=r.g:s&&(a=self);for(var c=!a.JS_SHA3_NO_COMMON_JS&&t.exports,u=r.amdO,f=!a.JS_SHA3_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,h="0123456789abcdef".split(""),d=[4,1024,262144,67108864],p=[0,8,16,24],_=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],l=[224,256,384,512],E=[128,256],O=["hex","buffer","arrayBuffer","array","digest"],y={128:168,256:136},T=a.JS_SHA3_NO_NODE_JS||!Array.isArray?function(t){return"[object Array]"===Object.prototype.toString.call(t)}:Array.isArray,S=!f||!a.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView?ArrayBuffer.isView:function(t){return"object"==typeof t&&t.buffer&&t.buffer.constructor===ArrayBuffer},R=function(t){var e=typeof t;if("string"===e)return[t,!0];if("object"!==e||null===t)throw new Error(o);if(f&&t.constructor===ArrayBuffer)return[new Uint8Array(t),!1];if(!T(t)&&!S(t))throw new Error(o);return[t,!1]},A=function(t){return 0===R(t)[0].length},g=function(t){for(var e=[],r=0;r<t.length;++r)e[r]=t[r];return e},v=function(t,e,r){return function(n){return new X(t,e,t).update(n)[r]()}},N=function(t,e,r){return function(n,o){return new X(t,e,o).update(n)[r]()}},w=function(t,e,r){return function(e,n,o,i){return P["cshake"+t].update(e,n,o,i)[r]()}},b=function(t,e,r){return function(e,n,o,i){return P["kmac"+t].update(e,n,o,i)[r]()}},M=function(t,e,r,n){for(var o=0;o<O.length;++o){var i=O[o];t[i]=e(r,n,i)}return t},C=function(t,e){var r=v(t,e,"hex");return r.create=function(){return new X(t,e,t)},r.update=function(t){return r.create().update(t)},M(r,v,t,e)},m=[{name:"keccak",padding:[1,256,65536,16777216],bits:l,createMethod:C},{name:"sha3",padding:[6,1536,393216,100663296],bits:l,createMethod:C},{name:"shake",padding:[31,7936,2031616,520093696],bits:E,createMethod:function(t,e){var r=N(t,e,"hex");return r.create=function(r){return new X(t,e,r)},r.update=function(t,e){return r.create(e).update(t)},M(r,N,t,e)}},{name:"cshake",padding:d,bits:E,createMethod:function(t,e){var r=y[t],n=w(t,0,"hex");return n.create=function(n,o,i){return A(o)&&A(i)?P["shake"+t].create(n):new X(t,e,n).bytepad([o,i],r)},n.update=function(t,e,r,o){return n.create(e,r,o).update(t)},M(n,w,t,e)}},{name:"kmac",padding:d,bits:E,createMethod:function(t,e){var r=y[t],n=b(t,0,"hex");return n.create=function(n,o,i){return new z(t,e,o).bytepad(["KMAC",i],r).bytepad([n],r)},n.update=function(t,e,r,o){return n.create(t,r,o).update(e)},M(n,b,t,e)}}],P={},B=[],k=0;k<m.length;++k)for(var x=m[k],F=x.bits,G=0;G<F.length;++G){var I=x.name+"_"+F[G];if(B.push(I),P[I]=x.createMethod(F[G],x.padding),"sha3"!==x.name){var D=x.name+F[G];B.push(D),P[D]=P[I]}}function X(t,e,r){this.blocks=[],this.s=[],this.padding=e,this.outputBits=r,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(t<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=r>>5,this.extraBytes=(31&r)>>3;for(var n=0;n<50;++n)this.s[n]=0}function z(t,e,r){X.call(this,t,e,r)}X.prototype.update=function(t){if(this.finalized)throw new Error("finalize already called");var e=R(t);t=e[0];for(var r,n,o=e[1],i=this.blocks,a=this.byteCount,s=t.length,c=this.blockCount,u=0,f=this.s;u<s;){if(this.reset)for(this.reset=!1,i[0]=this.block,r=1;r<c+1;++r)i[r]=0;if(o)for(r=this.start;u<s&&r<a;++u)(n=t.charCodeAt(u))<128?i[r>>2]|=n<<p[3&r++]:n<2048?(i[r>>2]|=(192|n>>6)<<p[3&r++],i[r>>2]|=(128|63&n)<<p[3&r++]):n<55296||n>=57344?(i[r>>2]|=(224|n>>12)<<p[3&r++],i[r>>2]|=(128|n>>6&63)<<p[3&r++],i[r>>2]|=(128|63&n)<<p[3&r++]):(n=65536+((1023&n)<<10|1023&t.charCodeAt(++u)),i[r>>2]|=(240|n>>18)<<p[3&r++],i[r>>2]|=(128|n>>12&63)<<p[3&r++],i[r>>2]|=(128|n>>6&63)<<p[3&r++],i[r>>2]|=(128|63&n)<<p[3&r++]);else for(r=this.start;u<s&&r<a;++u)i[r>>2]|=t[u]<<p[3&r++];if(this.lastByteIndex=r,r>=a){for(this.start=r-a,this.block=i[c],r=0;r<c;++r)f[r]^=i[r];j(f),this.reset=!0}else this.start=r}return this},X.prototype.encode=function(t,e){var r=255&t,n=1,o=[r];for(r=255&(t>>=8);r>0;)o.unshift(r),r=255&(t>>=8),++n;return e?o.push(n):o.unshift(n),this.update(o),o.length},X.prototype.encodeString=function(t){var e=R(t);t=e[0];var r=e[1],n=0,o=t.length;if(r)for(var i=0;i<t.length;++i){var a=t.charCodeAt(i);a<128?n+=1:a<2048?n+=2:a<55296||a>=57344?n+=3:(a=65536+((1023&a)<<10|1023&t.charCodeAt(++i)),n+=4)}else n=o;return n+=this.encode(8*n),this.update(t),n},X.prototype.bytepad=function(t,e){for(var r=this.encode(e),n=0;n<t.length;++n)r+=this.encodeString(t[n]);var o=(e-r%e)%e,i=[];return i.length=o,this.update(i),this},X.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex,r=this.blockCount,n=this.s;if(t[e>>2]|=this.padding[3&e],this.lastByteIndex===this.byteCount)for(t[0]=t[r],e=1;e<r+1;++e)t[e]=0;for(t[r-1]|=2147483648,e=0;e<r;++e)n[e]^=t[e];j(n)}},X.prototype.toString=X.prototype.hex=function(){this.finalize();for(var t,e=this.blockCount,r=this.s,n=this.outputBlocks,o=this.extraBytes,i=0,a=0,s="";a<n;){for(i=0;i<e&&a<n;++i,++a)t=r[i],s+=h[t>>4&15]+h[15&t]+h[t>>12&15]+h[t>>8&15]+h[t>>20&15]+h[t>>16&15]+h[t>>28&15]+h[t>>24&15];a%e===0&&(r=g(r),j(r),i=0)}return o&&(t=r[i],s+=h[t>>4&15]+h[15&t],o>1&&(s+=h[t>>12&15]+h[t>>8&15]),o>2&&(s+=h[t>>20&15]+h[t>>16&15])),s},X.prototype.arrayBuffer=function(){this.finalize();var t,e=this.blockCount,r=this.s,n=this.outputBlocks,o=this.extraBytes,i=0,a=0,s=this.outputBits>>3;t=o?new ArrayBuffer(n+1<<2):new ArrayBuffer(s);for(var c=new Uint32Array(t);a<n;){for(i=0;i<e&&a<n;++i,++a)c[a]=r[i];a%e===0&&(r=g(r),j(r))}return o&&(c[a]=r[i],t=t.slice(0,s)),t},X.prototype.buffer=X.prototype.arrayBuffer,X.prototype.digest=X.prototype.array=function(){this.finalize();for(var t,e,r=this.blockCount,n=this.s,o=this.outputBlocks,i=this.extraBytes,a=0,s=0,c=[];s<o;){for(a=0;a<r&&s<o;++a,++s)t=s<<2,e=n[a],c[t]=255&e,c[t+1]=e>>8&255,c[t+2]=e>>16&255,c[t+3]=e>>24&255;s%r===0&&(n=g(n),j(n))}return i&&(t=s<<2,e=n[a],c[t]=255&e,i>1&&(c[t+1]=e>>8&255),i>2&&(c[t+2]=e>>16&255)),c},z.prototype=new X,z.prototype.finalize=function(){return this.encode(this.outputBits,!0),X.prototype.finalize.call(this)};var j=function(t){var e,r,n,o,i,a,s,c,u,f,h,d,p,l,E,O,y,T,S,R,A,g,v,N,w,b,M,C,m,P,B,k,x,F,G,I,D,X,z,j,H,J,L,K,W,U,V,Y,$,Q,Z,q,tt,et,rt,nt,ot,it,at,st,ct,ut,ft;for(n=0;n<48;n+=2)o=t[0]^t[10]^t[20]^t[30]^t[40],i=t[1]^t[11]^t[21]^t[31]^t[41],a=t[2]^t[12]^t[22]^t[32]^t[42],s=t[3]^t[13]^t[23]^t[33]^t[43],c=t[4]^t[14]^t[24]^t[34]^t[44],u=t[5]^t[15]^t[25]^t[35]^t[45],f=t[6]^t[16]^t[26]^t[36]^t[46],h=t[7]^t[17]^t[27]^t[37]^t[47],e=(d=t[8]^t[18]^t[28]^t[38]^t[48])^(a<<1|s>>>31),r=(p=t[9]^t[19]^t[29]^t[39]^t[49])^(s<<1|a>>>31),t[0]^=e,t[1]^=r,t[10]^=e,t[11]^=r,t[20]^=e,t[21]^=r,t[30]^=e,t[31]^=r,t[40]^=e,t[41]^=r,e=o^(c<<1|u>>>31),r=i^(u<<1|c>>>31),t[2]^=e,t[3]^=r,t[12]^=e,t[13]^=r,t[22]^=e,t[23]^=r,t[32]^=e,t[33]^=r,t[42]^=e,t[43]^=r,e=a^(f<<1|h>>>31),r=s^(h<<1|f>>>31),t[4]^=e,t[5]^=r,t[14]^=e,t[15]^=r,t[24]^=e,t[25]^=r,t[34]^=e,t[35]^=r,t[44]^=e,t[45]^=r,e=c^(d<<1|p>>>31),r=u^(p<<1|d>>>31),t[6]^=e,t[7]^=r,t[16]^=e,t[17]^=r,t[26]^=e,t[27]^=r,t[36]^=e,t[37]^=r,t[46]^=e,t[47]^=r,e=f^(o<<1|i>>>31),r=h^(i<<1|o>>>31),t[8]^=e,t[9]^=r,t[18]^=e,t[19]^=r,t[28]^=e,t[29]^=r,t[38]^=e,t[39]^=r,t[48]^=e,t[49]^=r,l=t[0],E=t[1],U=t[11]<<4|t[10]>>>28,V=t[10]<<4|t[11]>>>28,C=t[20]<<3|t[21]>>>29,m=t[21]<<3|t[20]>>>29,st=t[31]<<9|t[30]>>>23,ct=t[30]<<9|t[31]>>>23,J=t[40]<<18|t[41]>>>14,L=t[41]<<18|t[40]>>>14,F=t[2]<<1|t[3]>>>31,G=t[3]<<1|t[2]>>>31,O=t[13]<<12|t[12]>>>20,y=t[12]<<12|t[13]>>>20,Y=t[22]<<10|t[23]>>>22,$=t[23]<<10|t[22]>>>22,P=t[33]<<13|t[32]>>>19,B=t[32]<<13|t[33]>>>19,ut=t[42]<<2|t[43]>>>30,ft=t[43]<<2|t[42]>>>30,et=t[5]<<30|t[4]>>>2,rt=t[4]<<30|t[5]>>>2,I=t[14]<<6|t[15]>>>26,D=t[15]<<6|t[14]>>>26,T=t[25]<<11|t[24]>>>21,S=t[24]<<11|t[25]>>>21,Q=t[34]<<15|t[35]>>>17,Z=t[35]<<15|t[34]>>>17,k=t[45]<<29|t[44]>>>3,x=t[44]<<29|t[45]>>>3,N=t[6]<<28|t[7]>>>4,w=t[7]<<28|t[6]>>>4,nt=t[17]<<23|t[16]>>>9,ot=t[16]<<23|t[17]>>>9,X=t[26]<<25|t[27]>>>7,z=t[27]<<25|t[26]>>>7,R=t[36]<<21|t[37]>>>11,A=t[37]<<21|t[36]>>>11,q=t[47]<<24|t[46]>>>8,tt=t[46]<<24|t[47]>>>8,K=t[8]<<27|t[9]>>>5,W=t[9]<<27|t[8]>>>5,b=t[18]<<20|t[19]>>>12,M=t[19]<<20|t[18]>>>12,it=t[29]<<7|t[28]>>>25,at=t[28]<<7|t[29]>>>25,j=t[38]<<8|t[39]>>>24,H=t[39]<<8|t[38]>>>24,g=t[48]<<14|t[49]>>>18,v=t[49]<<14|t[48]>>>18,t[0]=l^~O&T,t[1]=E^~y&S,t[10]=N^~b&C,t[11]=w^~M&m,t[20]=F^~I&X,t[21]=G^~D&z,t[30]=K^~U&Y,t[31]=W^~V&$,t[40]=et^~nt&it,t[41]=rt^~ot&at,t[2]=O^~T&R,t[3]=y^~S&A,t[12]=b^~C&P,t[13]=M^~m&B,t[22]=I^~X&j,t[23]=D^~z&H,t[32]=U^~Y&Q,t[33]=V^~$&Z,t[42]=nt^~it&st,t[43]=ot^~at&ct,t[4]=T^~R&g,t[5]=S^~A&v,t[14]=C^~P&k,t[15]=m^~B&x,t[24]=X^~j&J,t[25]=z^~H&L,t[34]=Y^~Q&q,t[35]=$^~Z&tt,t[44]=it^~st&ut,t[45]=at^~ct&ft,t[6]=R^~g&l,t[7]=A^~v&E,t[16]=P^~k&N,t[17]=B^~x&w,t[26]=j^~J&F,t[27]=H^~L&G,t[36]=Q^~q&K,t[37]=Z^~tt&W,t[46]=st^~ut&et,t[47]=ct^~ft&rt,t[8]=g^~l&O,t[9]=v^~E&y,t[18]=k^~N&b,t[19]=x^~w&M,t[28]=J^~F&I,t[29]=L^~G&D,t[38]=q^~K&U,t[39]=tt^~W&V,t[48]=ut^~et&nt,t[49]=ft^~rt&ot,t[0]^=_[n],t[1]^=_[n+1]};if(c)t.exports=P;else{for(k=0;k<B.length;++k)a[B[k]]=P[B[k]];u&&(void 0===(n=function(){return P}.call(e,r,e,t))||(t.exports=n))}}()}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.amdO={},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";var t,e;!function(t){t.FROM_PAGE="FROM_PAGE",t.FROM_EXTENSION="FROM_EXTENSION",t.FROM_BG="FROM_BG",t.FROM_CONTENT="FROM_CONTENT"}(t||(t={})),function(t){t.EXT_LOST_CONNECTION="EXT_LOST_CONNECTION",t.EXT_CHECK="EXT_CHECK",t.EXT_PRESENT="EXT_PRESENT",t.SEND_PROMPT="SEND_PROMPT",t.GET_PROOF_TOKEN="GET_PROOF_TOKEN",t.GET_BROWSER_INFO="GET_BROWSER_INFO",t.SSE_PART="SSE_PART",t.SSE_DONE="SSE_DONE",t.SSE_ERROR="SSE_ERROR",t.GPT_STREAM_PART="GPT_STREAM_PART",t.GPT_STREAM_DONE="GPT_STREAM_DONE",t.GPT_STREAM_ERROR="GPT_STREAM_ERROR"}(e||(e={}));var n=r(176),o=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))};function i(e,r){const n={type:t.FROM_EXTENSION,action:e,payload:r};window.postMessage(n,"*")}function a(t,e){return o(this,void 0,void 0,(function*(){let r=[navigator.hardwareConcurrency+screen.width+screen.height,(new Date).toString(),4294705152,0,navigator.userAgent];for(let o=0;o<1e5;o++){r[3]=o;let i=JSON.stringify(r),a=(new TextEncoder).encode(i),s=btoa(String.fromCharCode(...a));if((0,n.sha3_512)(t+s).slice(0,e.length)<=e)return`gAAAAAB${s}`}return`gAAAAABwQ8Lk5FbGpA2NcR9dShT6gYjU7VxZ4D${btoa(t)}`}))}console.log("Content script loaded");const s=chrome.runtime.getManifest().version;var c;c=s,window.addEventListener("message",(r=>{var n;if(r.source===window&&(null===(n=r.data)||void 0===n?void 0:n.type)&&r.data.action&&r.data.type==t.FROM_PAGE)if(r.data.action===e.SEND_PROMPT)try{chrome.runtime.sendMessage({type:t.FROM_CONTENT,action:e.SEND_PROMPT,prompt:r.data.payload.prompt},(t=>{t.error?i(e.GPT_STREAM_PART,{error:!0,content:t.error}):chrome.runtime.lastError&&i(e.EXT_LOST_CONNECTION)}))}catch(t){console.log("Lỗi gửi message đến background:",t),i(e.EXT_LOST_CONNECTION)}else r.data.action===e.EXT_CHECK&&i(e.EXT_PRESENT,{version:c})})),chrome.runtime.onMessage.addListener(((r,n,o)=>{if(r.type!==t.FROM_BG)return o("Response from content"),!0;if(r.action===e.GET_PROOF_TOKEN)return a(r.params[0],r.params[1]).then((t=>{o(t)})).catch((t=>{console.error("Token generation error",t),o("")})),!0;if(r.action===e.GET_BROWSER_INFO){const t={page_height:document.documentElement.scrollHeight,page_width:document.documentElement.scrollWidth,pixel_ratio:window.devicePixelRatio,screen_height:window.screen.height,screen_width:window.screen.width};o(t)}return r.action===e.SSE_PART&&(i(e.GPT_STREAM_PART,{content:r.content}),o(!0)),r.action===e.SSE_DONE&&(i(e.GPT_STREAM_DONE,{content:r.content}),o(!0)),!0}))})()})();